#!/bin/sh

if [ -z "$1" ]
then
    echo -n "Please choose a FQDN for this certificate [eg. mesmateriaux.dev]: "
    read COMMON_NAME
else
    COMMON_NAME="$1"
fi

openssl genrsa 2048 > host.key
openssl req -new -x509 -nodes -sha1 -days 3650 -key host.key -subj "/C=FR/ST=Loire-Atlantique/L=Le Mans/O=PBH SAS/OU=IT Department/CN=$COMMON_NAME" > host.crt
openssl x509 -noout -fingerprint -text < host.crt > host.info
cat host.crt host.key > host.pem
chmod 400 host.key host.pem

# Mac OSX specific
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain host.crt
